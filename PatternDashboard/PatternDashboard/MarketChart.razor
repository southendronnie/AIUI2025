@using AIUI2025.Services
@inject IJSRuntime JS
@inject MarketDataService MarketData

<div id="chartContainer" style="height: 400px; min-width: 310px"></div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var start = new DateTime(2025, 9, 15, 9, 0, 0);
            var end = new DateTime(2025, 9, 16, 11, 0, 0);

            var candles = await MarketData.GetCandlesAsync(start, end);

            var chartData = candles.Select(c => new object[]
            {
                DateTimeToUnix(c.Time),
                c.Open, c.High, c.Low, c.Close
            }).ToArray();

            await JS.InvokeVoidAsync("renderCandleChart", "chartContainer", chartData);
        }
    }

    private long DateTimeToUnix(DateTime dt)
    {
        return new DateTimeOffset(dt).ToUnixTimeMilliseconds();
    }
}