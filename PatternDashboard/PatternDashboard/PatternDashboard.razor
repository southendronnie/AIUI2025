@inject IJSRuntime JS
@inject MarketDataService MarketData

<h3>Pattern Dashboard</h3>
<div id="chartContainer" style="height: 400px; min-width: 310px"></div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var candles = await MarketData.GetCandlesAsync();
            var chartData = candles.Select(c => new object[]
            {
                DateTimeToUnix(c.Time),
                c.Open, c.High, c.Low, c.Close
            }).ToArray();

            await JS.InvokeVoidAsync("renderCandleChart", "chartContainer", chartData);
        }
    }

    private long DateTimeToUnix(DateTime dt)
    {
        return new DateTimeOffset(dt).ToUnixTimeMilliseconds();
    }
}